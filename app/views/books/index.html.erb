<h1>Books</h1>
<table>
	<tr>
		<td>Title</td>
		<td>Comments</td>
		<td>Category</td>
		<td>Date</td>
		<td>Rating</td>
		<td>Available to Borrow</td>
		<td>User</td>
	</tr>

	<% @books.each do |book| %>
	<tr>
		<td><%= book.title%></td>
		<% if !book.filepicker_url.nil?%>
		<td><%= filepicker_image_tag book.filepicker_url, w:160, h:160, fit: 'clip' %></td>
		<%end%>

		<td><%= book.body%></td>
		<td><%= book.category%></td>
		<td><%= book.date%></td>
		<td><%= book.rating%></td>
		<td><% if book.available%>
			<%="I own it"%>
			<%else%>
			<%="I don't own it"%>
			<%end%></td>

		<% if current_user.id? %>
			<% if !(Borrowed.find_by book_id: book.id) && book.available %>
				<td> <%= form_for(@borrowed) do |f| %>
					<div class = "field">
					<%= f.hidden_field :user_id, :value => current_user.id %> </div>
					<div class = "field">
					<%= f.hidden_field :book_id, :value => book.id %> </div>
					<div class= "actions">
					<%= f.submit %> </div>
					<%end%>
				</td>
			<%else%>
				<td> <%= "This book is out" %> </td>
			<%end%>
		<%end%>

		<td><%= book.user.name unless book.user.nil?%></td>
		<td><%= link_to 'Show', book %></td>
		<td><%= link_to 'Edit', edit_book_path(book) %></td>
		<td><%= link_to 'Delete', book_path(book),
                    method: :delete, data: { confirm: 'Are you sure?' } %></td>
	</tr>
	<%end%>
</table>
